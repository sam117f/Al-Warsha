name: Auto-Fix & Build ğŸ› ï¸

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  fix_build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2
        with:
          gradle-version: '8.2'

      # 1. Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¬Ø°Ø±ÙŠ: Ø¥Ø¹Ø§Ø¯Ø© ÙƒØªØ§Ø¨Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ø¶Ù…Ø§Ù† ØµØ­ØªÙ‡Ø§
      - name: Force Fix Config Files
        run: |
          echo 'pluginManagement { repositories { google(); mavenCentral(); gradlePluginPortal() } }' > settings.gradle.kts
          echo 'dependencyResolutionManagement { repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS); repositories { google(); mavenCentral() } }' >> settings.gradle.kts
          echo 'rootProject.name = "Al-Warsha"' >> settings.gradle.kts
          echo 'include(":app")' >> settings.gradle.kts
          
          echo 'plugins { id("com.android.application") version "8.1.0" apply false; id("org.jetbrains.kotlin.android") version "1.8.0" apply false }' > build.gradle.kts

      # 2. ØªØ´Ø®ÙŠØµ: Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù†Ø¹Ø±Ù Ù…Ø§Ø°Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
      - name: List Files (Debug)
        run: find . -maxdepth 4 -not -path '*/.*'

      # 3. Ø§Ù„Ø¨Ù†Ø§Ø¡
      - name: Build APK
        run: gradle assembleDebug --stacktrace --no-daemon

      # 4. Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: Al-Warsha-App
          path: app/build/outputs/apk/debug/app-debug.apk
          
